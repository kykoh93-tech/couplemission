<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>ç®€åŒ–è·‘é…· Mario é£æ ¼æ¸¸æˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
body {
  margin:0;
  background:#87ceeb;
  display:flex;
  flex-direction:column;
  align-items:center;
  font-family: Arial, sans-serif;
}
canvas { background:#87ceeb; display:block; margin-top:20px; }
.controls { margin-top:10px; }
.btn {
  background:#22c55e; color:#fff; font-size:24px;
  border-radius:8px; padding:10px 20px;
  user-select:none;
}
.btn:active { background:#16a34a; }
.scoreboard { margin-top:10px; font-size:18px; }
</style>
</head>
<body>
<h3>ç®€åŒ–è·‘é…· Mario é£æ ¼æ¸¸æˆ ğŸ…</h3>
<canvas id="game" width="400" height="200"></canvas>
<div class="controls">
  <button class="btn" onclick="jump()">â¬†ï¸ è·³è·ƒ</button>
</div>
<div class="scoreboard" id="scoreboard">å¾—åˆ†ï¼š0</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const gravity = 0.6;

let player, platforms, tomatoes, score, timer;

function startGame() {
  player = {x:50, y:150, w:20, h:20, dy:0, onGround:false};
  
  // åˆå§‹è¿ç»­åœ°é¢å¹³å°
  platforms = [
    {x:0, y:180, w:400, h:20}
  ];
  
  tomatoes = [];
  score = 0;
  updateScore();
  clearInterval(timer);
  timer = setInterval(gameLoop, 20);
}

function jump(){ 
  if(player.onGround){ 
    player.dy=-10; 
    player.onGround=false; 
  } 
}

function updateScore(){ 
  document.getElementById("scoreboard").textContent="å¾—åˆ†ï¼š"+score; 
}

function gameLoop(){
  // ç©å®¶è‡ªåŠ¨å‘å³ç§»åŠ¨
  player.x += 2;
  player.dy += gravity;
  player.y += player.dy;

  // å¹³å°ç¢°æ’
  player.onGround=false;
  platforms.forEach(p=>{
    if(player.x+player.w>p.x && player.x<p.x+p.w && player.y+player.h>p.y && player.y+player.h<p.y+p.h+player.dy){
      player.y=p.y-player.h;
      player.dy=0;
      player.onGround=true;
    }
  });

  // æ»šåŠ¨å¹³å°å’Œç•ªèŒ„
  platforms.forEach(p=>{ p.x-=2; });
  tomatoes.forEach(t=>{ t.x-=2; });

  // ç§»é™¤å±å¹•å¤–çš„ç•ªèŒ„ï¼Œä½†åœ°é¢æŒç»­
  tomatoes = tomatoes.filter(t=>t.x+t.w>0);

  // ä¿æŒè¿ç»­åœ°é¢
  let lastPlatform = platforms[platforms.length-1];
  if(lastPlatform.x + lastPlatform.w < canvas.width){
    platforms.push({x: lastPlatform.x + lastPlatform.w, y:180, w:80, h:20});
  }

  // ç®€å•éšæœºç”Ÿæˆè·³è·ƒç•ªèŒ„
  if(Math.random()<0.02){
    let y = 120 + Math.random()*40; // ç•ªèŒ„é«˜åº¦
    tomatoes.push({x:canvas.width, y:y, w:10, h:10, collected:false});
  }

  // ç•ªèŒ„ç¢°æ’
  tomatoes.forEach(t=>{
    if(!t.collected && player.x+player.w>t.x && player.x<t.x+t.w && player.y+player.h>t.y && player.y<t.y+t.h){
      t.collected=true;
      score++;
      updateScore();
    }
  });

  draw();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // ç»˜åˆ¶å¹³å°
  ctx.fillStyle="#654321";
  platforms.forEach(p=>ctx.fillRect(p.x,p.y,p.w,p.h));

  // ç»˜åˆ¶ç•ªèŒ„
  ctx.fillStyle="red";
  tomatoes.forEach(t=>{ if(!t.collected) ctx.fillRect(t.x,t.y,t.w,t.h); });

  // ç»˜åˆ¶ç©å®¶
  ctx.fillStyle="blue";
  ctx.fillRect(player.x,player.y,player.w,player.h);
}

startGame();
</script>
</body>
</html>

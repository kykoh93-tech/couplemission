<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>ç•ªèŒ„ç‚¸å¼¹äººå‡çº§ç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
body { margin:0; background:#222; display:flex; flex-direction:column; align-items:center; font-family:Arial,sans-serif; }
canvas { background:#333; margin-top:20px; }
.controls { display:grid; grid-template-columns:60px 60px 60px; gap:5px; margin-top:10px; }
.btn { padding:10px; font-size:18px; border-radius:8px; background:#22c55e; color:white; user-select:none; }
.btn:active { background:#16a34a; }
</style>
</head>
<body>
<h3 style="color:white;">ç•ªèŒ„ç‚¸å¼¹äººå‡çº§ç‰ˆ</h3>
<canvas id="game" width="400" height="400"></canvas>
<div class="controls">
  <div></div><button class="btn" onclick="movePlayer(0,-1)">â¬†ï¸</button><div></div>
  <button class="btn" onclick="movePlayer(-1,0)">â¬…ï¸</button>
  <button class="btn" onclick="placeBomb()">ğŸ’£</button>
  <button class="btn" onclick="movePlayer(1,0)">â¡ï¸</button>
  <div></div><button class="btn" onclick="movePlayer(0,1)">â¬‡ï¸</button><div></div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const tileSize = 40;
const mapRows = 10, mapCols = 10;
let gameOver = false;

// åŠ è½½å›¾ç‰‡
let playerImg = new Image();
playerImg.src = 'tomato.png'; // ç©å®¶ç•ªèŒ„
let wormImg = new Image();
wormImg.src = 'worm.png'; // èš¯èš“æ€ªç‰©

// ç©å®¶åˆå§‹å®‰å…¨ä½ç½®
let player = {x:1, y:1, alive:true};

// èš¯èš“æ€ªç‰©
let monsters = [
  {x:8,y:8,dir:1,alive:true},
  {x:7,y:7,dir:1,alive:true}
];

// åœ°å›¾ï¼š0ç©º,1å›ºå®šå¢™,2å¯ç‚¸å¢™
let map = [
[1,1,1,1,1,1,1,1,1,1],
[1,0,2,0,2,0,2,0,2,1],
[1,2,1,2,1,2,1,2,0,1],
[1,0,2,0,2,0,2,0,2,1],
[1,2,1,2,1,2,1,2,0,1],
[1,0,2,0,2,0,2,0,2,1],
[1,2,1,2,1,2,1,2,0,1],
[1,0,2,0,2,0,2,0,2,1],
[1,0,0,2,0,2,0,2,0,1],
[1,1,1,1,1,1,1,1,1,1],
];

let bombs = [];
const explosionTime = 50;
const explosionRange = 1;

// ç©å®¶ç§»åŠ¨
function movePlayer(dx, dy){
  if(gameOver) return;
  let nx = player.x + dx, ny = player.y + dy;
  if(map[ny][nx]===0){
    player.x = nx; player.y = ny;
  }
}

// æ”¾ç‚¸å¼¹
function placeBomb(){
  if(gameOver) return;
  bombs.push({x:player.x,y:player.y,timer:explosionTime});
}

// æ¸¸æˆå¾ªç¯
function gameLoop(){
  if(gameOver) return;

  // æ›´æ–°ç‚¸å¼¹
  for(let i=bombs.length-1;i>=0;i--){
    bombs[i].timer--;
    if(bombs[i].timer<=0){
      explode(bombs[i]);
      bombs.splice(i,1);
    }
  }

  // èš¯èš“ç§»åŠ¨
  monsters.forEach(m=>{
    if(!m.alive) return;
    let nx = m.x + m.dir;
    if(map[m.y][nx]===0) m.x = nx;
    else m.dir *= -1;
  });

  draw();
}

// çˆ†ç‚¸é€»è¾‘
function explode(bomb){
  let positions = [{x:bomb.x,y:bomb.y}];
  const dirs=[[1,0],[-1,0],[0,1],[0,-1]];
  dirs.forEach(d=>{
    for(let i=1;i<=explosionRange;i++){
      let nx=bomb.x + d[0]*i, ny=bomb.y + d[1]*i;
      if(map[ny][nx]===1) break; // å›ºå®šå¢™é˜»æŒ¡
      positions.push({x:nx,y:ny});
      if(map[ny][nx]===2){ map[ny][nx]=0; break; } // å¯ç‚¸å¢™ç‚¸æ‰
    }
  });

  // æ£€æŸ¥èš¯èš“
  positions.forEach(pos=>{
    monsters.forEach(m=>{
      if(m.alive && m.x===pos.x && m.y===pos.y){
        m.alive=false;
      }
    });
  });

  // æ£€æŸ¥ç©å®¶
  positions.forEach(pos=>{
    if(player.x===pos.x && player.y===pos.y){
      player.alive=false;
      gameOver=true;
      alert("æ¸¸æˆç»“æŸï¼ç•ªèŒ„è¢«ç‚¸æ­»äº†ï¼");
    }
  });

  // ç»˜åˆ¶çˆ†ç‚¸çƒŸ
  positions.forEach(pos=>{
    ctx.fillStyle="orange";
    ctx.fillRect(pos.x*tileSize+10,pos.y*tileSize+10,20,20);
  });
}

// ç»˜åˆ¶åœ°å›¾å’Œè§’è‰²
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // åœ°å›¾
  for(let y=0;y<mapRows;y++){
    for(let x=0;x<mapCols;x++){
      if(map[y][x]===1) ctx.fillStyle="#555"; 
      else if(map[y][x]===2) ctx.fillStyle="#aaa"; 
      else ctx.fillStyle="#333";
      ctx.fillRect(x*tileSize,y*tileSize,tileSize,tileSize);
      ctx.strokeStyle="#222";
      ctx.strokeRect(x*tileSize,y*tileSize,tileSize,tileSize);
    }
  }

  // ç‚¸å¼¹
  ctx.fillStyle="black";
  bombs.forEach(b=>{
    ctx.beginPath();
    ctx.arc(b.x*tileSize+tileSize/2, b.y*tileSize+tileSize/2, 12,0,Math.PI*2);
    ctx.fill();
  });

  // ç©å®¶
  if(player.alive && playerImg.complete){
    ctx.drawImage(playerImg, player.x*tileSize+5, player.y*tileSize+5, 30, 30);
  }

  // èš¯èš“
  monsters.forEach(m=>{
    if(m.alive && wormImg.complete){
      ctx.drawImage(wormImg, m.x*tileSize+5, m.y*tileSize+5, 30, 30);
    }
  });
}

// ç­‰å¾…å›¾ç‰‡åŠ è½½å®Œæˆå†å¯åŠ¨æ¸¸æˆå¾ªç¯
playerImg.onload = wormImg.onload = function(){
  setInterval(gameLoop, 200);
};
</script>
</body>
</html>

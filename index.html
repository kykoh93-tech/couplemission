<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>è‡ªåŠ¨è·‘é…· Mario é£æ ¼æ¸¸æˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
body {
  margin:0;
  background:#87ceeb;
  display:flex;
  flex-direction:column;
  align-items:center;
  font-family: Arial, sans-serif;
}
canvas { background:#87ceeb; display:block; margin-top:20px; }
.controls { margin-top:10px; }
.btn {
  background:#22c55e; color:#fff; font-size:24px;
  border-radius:8px; padding:10px 20px;
  user-select:none;
}
.btn:active { background:#16a34a; }
.scoreboard { margin-top:10px; font-size:18px; }
</style>
</head>
<body>
<h3>è‡ªåŠ¨è·‘é…· Mario é£æ ¼æ¸¸æˆ ğŸ…</h3>
<canvas id="game" width="400" height="200"></canvas>
<div class="controls">
  <button class="btn" onclick="jump()">â¬†ï¸ è·³è·ƒ</button>
</div>
<div class="scoreboard" id="scoreboard">å¾—åˆ†ï¼š0</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const gravity = 0.6;
let player, platforms, tomatoes, score, timer;

// åˆå§‹åŒ–æ¸¸æˆ
function startGame() {
  player = {x:50, y:150, w:20, h:20, dy:0, onGround:false};
  platforms = [{x:0,y:180,w:400,h:20}]; // åˆå§‹åœ°é¢
  tomatoes = [];
  score = 0;
  updateScore();
  clearInterval(timer);
  timer = setInterval(gameLoop, 20);
}

// è·³è·ƒ
function jump(){ if(player.onGround){ player.dy=-10; player.onGround=false; } }

// æ›´æ–°å¾—åˆ†æ˜¾ç¤º
function updateScore(){ document.getElementById("scoreboard").textContent="å¾—åˆ†ï¼š"+score; }

// æ¸¸æˆå¾ªç¯
function gameLoop(){
  // è‡ªåŠ¨å‘å³æ»šåŠ¨
  player.x += 2;

  // ç©å®¶é‡åŠ›
  player.dy += gravity;
  player.y += player.dy;

  // å¹³å°ç¢°æ’
  player.onGround=false;
  platforms.forEach(p=>{
    if(player.x+player.w>p.x && player.x<p.x+p.w && player.y+player.h>p.y && player.y+player.h<p.y+p.h+player.dy){
      player.y=p.y-player.h;
      player.dy=0;
      player.onGround=true;
    }
  });

  // æ»šåŠ¨å¹³å°å’Œç•ªèŒ„
  platforms.forEach(p=>{ p.x-=2; });
  tomatoes.forEach(t=>{ t.x-=2; });

  // ç§»é™¤ç¦»å¼€å±å¹•çš„åœ°é¢å’Œç•ªèŒ„
  platforms = platforms.filter(p=>p.x+p.w>0);
  tomatoes = tomatoes.filter(t=>t.x+t.w>0);

  // éšæœºç”Ÿæˆæ–°å¹³å°å’Œç•ªèŒ„
  if(Math.random()<0.02) {
    let y = 100 + Math.random()*60;
    platforms.push({x:canvas.width, y:y, w:80, h:20});
    if(Math.random()<0.5) tomatoes.push({x:canvas.width+30, y:y-20, w:10, h:10, collected:false});
  }

  // ç•ªèŒ„ç¢°æ’
  tomatoes.forEach(t=>{
    if(!t.collected && player.x+player.w>t.x && player.x<t.x+t.w && player.y+player.h>t.y && player.y<t.y+t.h){
      t.collected=true;
      score++;
      updateScore();
    }
  });

  // ç»˜åˆ¶
  draw();
}

// ç»˜åˆ¶
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // ç»˜åˆ¶å¹³å°
  ctx.fillStyle="#654321";
  platforms.forEach(p=>ctx.fillRect(p.x,p.y,p.w,p.h));

  // ç»˜åˆ¶ç•ªèŒ„ï¼ˆé‡‘å¸ï¼‰
  ctx.fillStyle="red";
  tomatoes.forEach(t=>{ if(!t.collected) ctx.fillRect(t.x,t.y,t.w,t.h); });

  // ç»˜åˆ¶ç©å®¶ï¼ˆMarioï¼‰
  ctx.fillStyle="blue";
  ctx.fillRect(player.x,player.y,player.w,player.h);
}

startGame();
</script>
</body>
</html>
